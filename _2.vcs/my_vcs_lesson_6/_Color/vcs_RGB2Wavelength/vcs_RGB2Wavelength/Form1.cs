using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace vcs_RGB2Wavelength
{
    public partial class Form1 : Form
    {
        double[,] rgb_data = new double[,] {
{380,0.1741,0.0050,0.8209,0.00145,0.0000,0.0065 },
{385,0.1740,0.0050,0.8210,0.0022,0.0001,0.0105 },
{390,0.1738,0.0049,0.8213,0.0042,0.0001,0.0201 },
{395,0.1736,0.0049,0.8215,0.0076,0.0002,0.0362 },
{400,0.1733,0.0048,0.8219,0.0143,0.0004,0.0679 },
{405,0.1730,0.0048,0.8222,0.0232,0.0006,0.1102 },
{410,0.1726,0.0048,0.8226,0.0435,0.0012,0.2074 },
{415,0.1721,0.0048,0.8231,0.0776,0.0022,0.3713 },
{420,0.1714,0.0051,0.8235,0.1344,0.0040,0.6456 },
{425,0.1703,0.0058,0.8239,0.2148,0.0073,1.0391 },
{430,0.1689,0.0069,0.8242,0.2839,0.0116,1.3856 },
{435,0.1669,0.0086,0.8245,0.3285,0.0168,1.6230 },
{440,0.1644,0.0109,0.8247,0.3483,0.0230,1.7471 },
{445,0.1611,0.0138,0.8251,0.3481,0.0298,1.7826 },
{450,0.1566,0.0177,0.8257,0.3362,0.0380,1.7721 },
{455,0.1510,0.0227,0.8263,0.3187,0.0480,1.7441 },
{460,0.1440,0.0297,0.8263,0.2908,0.0600,1.6692 },
{465,0.1355,0.0399,0.8246,0.2511,0.0739,1.5281 },
{470,0.1241,0.0578,0.8181,0.1954,0.0910,1.2876 },
{475,0.1096,0.0868,0.8036,0.1421,0.1126,1.0419 },
{480,0.0913,0.1327,0.7760,0.0956,0.1390,0.8130 },
{485,0.0687,0.2007,0.7306,0.0580,0.1693,0.6162 },
{490,0.0454,0.2950,0.6596,0.0320,0.2080,0.4652 },
{495,0.0235,0.4127,0.5638,0.0147,0.2586,0.3533 },
{500,0.0082,0.5384,0.4534,0.0049,0.3230,0.2720 },
{505,0.0039,0.6548,0.3413,0.0024,0.4073,0.2123 },
{510,0.0139,0.7502,0.2359,0.0093,0.5030,0.1582 },
{515,0.0389,0.8120,0.1491,0.0291,0.6082,0.1117 },
{520,0.0743,0.8338,0.0919,0.0633,0.7100,0.0782 },
{525,0.1142,0.8262,0.0596,0.1096,0.7932,0.0573 },
{530,0.1547,0.8059,0.0394,0.1655,0.8620,0.0422 },
{535,0.1929,0.7816,0.0255,0.2257,0.9149,0.0298 },
{540,0.2296,0.7543,0.0161,0.2904,0.9540,0.0203 },
{545,0.2658,0.7243,0.0099,0.3597,0.9803,0.0134 },
{550,0.3016,0.6923,0.0061,0.4334,0.9950,0.0087 },
{555,0.3373,0.6589,0.0038,0.5121,1.0000,0.0057 },
{560,0.3731,0.6245,0.0024,0.5945,0.9950,0.0039 },
{565,0.4087,0.5896,0.0017,0.6784,0.9786,0.0027 },
{570,0.4441,0.5547,0.0012,0.7621,0.9520,0.0021 },
{575,0.4788,0.5202,0.0010,0.8425,0.9154,0.0010 },
{580,0.5125,0.4866,0.0009,0.9163,0.8700,0.0017 },
{585,0.5448,0.4544,0.0008,0.9786,0.8163,0.0014 },
{590,0.5752,0.4242,0.0006,1.0263,0.7570,0.0011 },
{595,0.6029,0.3965,0.0006,1.0567,0.6949,0.0010 },
{600,0.6270,0.3725,0.0005,1.0522,0.6130,0.0008 },
{605,0.6482,0.3514,0.0004,1.0456,0.5668,0.0006 },
{610,0.6658,0.3340,0.0002,1.0026,0.5030,0.0003 },
{615,0.6801,0.3197,0.0002,0.9384,0.4412,0.0002 },
{620,0.6915,0.3083,0.0002,0.8544,0.3810,0.0002 },
{625,0.7006,0.2993,0.0001,0.7514,0.3210,0.0001 },
{630,0.7079,0.2920,0.0001,0.6424,0.2650,0.0000 },
{635,0.7140,0.2859,0.0001,0.5419,0.2170,0.0000 },
{640,0.7219,0.2809,0.0001,0.4479,0.1750,0.0000 },
{645,0.7230,0.2770,0.0000,0.3608,0.1382,0.0000 },
{650,0.7260,0.2740,0.0000,0.2835,0.1070,0.0000 },
{655,0.7283,0.2717,0.0000,0.2187,0.0816,0.0000 },
{660,0.7300,0.2700,0.0000,0.1649,0.0610,0.0000 },
{665,0.7311,0.2689,0.0000,0.1212,0.0446,0.0000 },
{670,0.7320,0.2680,0.0000,0.0874,0.0320,0.0000 },
{675,0.7327,0.2673,0.0000,0.0636,0.0232,0.0000 },
{680,0.7334,0.2666,0.0000,0.0468,0.0170,0.0000 },
{685,0.7340,0.2660,0.0000,0.0329,0.0119,0.0000 },
{690,0.7344,0.2656,0.0000,0.0227,0.0082,0.0000 },
{695,0.7346,0.2654,0.0000,0.0158,0.0057,0.0000 },
{700,0.7347,0.2653,0.0000,0.0114,0.0041,0.0000 },
{705,0.7347,0.2653,0.0000,0.0081,0.0029,0.0000 },
{710,0.7347,0.2653,0.0000,0.0058,0.0021,0.0000 },
{715,0.7347,0.2653,0.0000,0.0041,0.0015,0.0000 },
{720,0.7347,0.2653,0.0000,0.0029,0.0010,0.0000 },
{725,0.7347,0.2653,0.0000,0.0020,0.0007,0.0000 },
{730,0.7347,0.2653,0.0000,0.0014,0.0005,0.0000 },
{735,0.7347,0.2653,0.0000,0.0010,0.0004,0.0000 },
{740,0.7347,0.2653,0.0000,0.0007,0.0002,0.0000 },
{745,0.7347,0.2653,0.0000,0.0005,0.0002,0.0000 },
{750,0.7347,0.2653,0.0000,0.0003,0.0001,0.0000 },
{755,0.7347,0.2653,0.0000,0.0002,0.0001,0.0000 },
{760,0.7347,0.2653,0.0000,0.0002,0.0001,0.0000 },
{765,0.7347,0.2653,0.0000,0.0001,0.0000,0.0000 },
{770,0.7347,0.2653,0.0000,0.0001,0.0000,0.0000 },
{775,0.7347,0.2653,0.0000,0.0001,0.0000,0.0000 },
{780,0.7347,0.2653,0.0000,0.0000,0.0000,0.0000 }
};

        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }

        private void button1_Click(object sender, EventArgs e)
        {
            double r = 255;
            double g = 0;
            double b = 0;

            double x = 0;
            double y = 0;
            double z = 0;

            x = (0.490 * r + 0.310 * g + 0.200 * b) / (0.667 * r + 1.132 * g + 1.200 * b);

            y = (0.117 * r + 0.812 * g + 0.010 * b) / (0.667 * r + 1.132 * g + 1.200 * b);

            z = (0.000 * r + 0.010 * g + 0.990 * b) / (0.667 * r + 1.132 * g + 1.200 * b);

            richTextBox1.Text += "x = " + x.ToString() + "\n";
            richTextBox1.Text += "y = " + y.ToString() + "\n";
            richTextBox1.Text += "z = " + z.ToString() + "\n";


        }

        private void button2_Click(object sender, EventArgs e)
        {
            Color color = Color.Blue;

            int wavelength = RGBToWavelength(color);
            richTextBox1.Text += "wavelength = " + wavelength.ToString() + "\n";
        }

        int RGBToWavelength(Color color)
        {
            int wavelength = 0;
            int ROW = rgb_data.GetUpperBound(0) + 1;//獲取指定維度的上限，在 上一個1就是列數
            int COL = rgb_data.GetLength(1);//獲取指定維中的元 個數，這裡也就是列數了。（1表示的是第二維，0是第一維）
            int length = rgb_data.Length;//獲取整個二維陣列的長度，即所有元 的個數
            richTextBox1.Text += "ROW = " + ROW.ToString() + "\n";
            richTextBox1.Text += "COL = " + COL.ToString() + "\n";
            richTextBox1.Text += "length = " + length.ToString() + "\n";

            double r = color.R;
            double g = color.G;
            double b = color.B;

            double x = 0;
            double y = 0;
            double z = 0;

            x = (0.490 * r + 0.310 * g + 0.200 * b) / (0.667 * r + 1.132 * g + 1.200 * b);
            y = (0.117 * r + 0.812 * g + 0.010 * b) / (0.667 * r + 1.132 * g + 1.200 * b);
            z = (0.000 * r + 0.010 * g + 0.990 * b) / (0.667 * r + 1.132 * g + 1.200 * b);

            richTextBox1.Text += "x = " + x.ToString() + "\n";
            richTextBox1.Text += "y = " + y.ToString() + "\n";
            richTextBox1.Text += "z = " + z.ToString() + "\n";

            double abs_min = double.MaxValue;
            double abs = 0;
            int index = 0;
            int i;
            for (i = 0; i < ROW; i++)
            {
                abs = Math.Abs(rgb_data[i, 1] - x) + Math.Abs(rgb_data[i, 2] - y) + Math.Abs(rgb_data[i, 3] - z);
                if (abs < abs_min)
                {
                    abs_min = abs;
                    index = i;
                }
            }

            wavelength = (int)rgb_data[index, 0];
            richTextBox1.Text += "index = " + index.ToString() + "\twavelength = " + rgb_data[index, 0].ToString() + "\n";

            return wavelength;
        }

    }
}
