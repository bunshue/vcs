
若相機接上時，讀不到相機資料，重讀2次，

若皆不行，一律放行，為free mode，一律不讀寫相機flash/主機EEPROM


累計關機時間超過30分鐘


累計拔除時間超過30分鐘


plug_interval
本次拔除時間超過1分鐘



CAMERA_TYPE

CAMERA_TYPE_NEW		//找不到1分鐘使用記錄，允許使用
CAMERA_TYPE_NOTNEW	//有1分鐘使用記錄，繼續判斷

	CAMERA_TYPE_DIFFERENT	//有1分鐘使用記錄，但跟上次使用的相機不同，不允許使用
	CAMERA_TYPE_SAME	//有1分鐘使用記錄，跟上次使用的相機相同，繼續判斷
		讀上次關機時間	from eeprom
		讀上次勘用時拔除時間
		讀相機拔除時間 from eeprom
		讀相機使用時間 from camera (不滿30分或滿30分)
		
		
		相同相機 且 (斷電時間 > 30分)   => 禁止使用
		
		相機使用時間 > 30
		

difftime_30m = 4 Hours, 15 Minutes, 59 Seconds
camera_plug_in_time = 1529272 Seconds
camera_plug_interval = 2 Seconds
difftime_LAST_POWER_OFF = 160948 seconds
difftime_LAST_POWER_OFF = 1 Days, 20 Hours, 42 Minutes, 28 Seconds
system_uptime = 2064 seconds
from now to last power off time = 163012 seconds
from now to last power off time = 1 Days, 21 Hours, 16 Minutes, 52 Seconds

read_camera_fpga, page = 0xE = 14
CMD:    FF AA 06 89 74 08 00 00
CMD:    FF AA 03 70 FF

SET_ADDRESS_0x000E
CMD:    FF AA 0A 89 B4 00 00 00 40 00 00 0E
DATA:   AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA CF
CMD:    FF AA 05 89 26 00 00
camera_use_time_from_camera = 30
camera_use_time_from_eeprom = 40
camera_nouse_time_from_eeprom = 0
g_procedure_started = STOP

read_date_from_camera page = 0xF
CMD:    FF AA 06 89 74 08 00 00
CMD:    FF AA 03 70 FF








1. 是否全新相機	相機之0x0D有無一分資料



判斷順序及旗標

1. 系統上電/相機接上時，檢查相機是否為全新？
	讀相機之flash 0xD，若資料皆為0，則為全新相機。
	(沒有使用1分鐘的紀錄，就是全新相機)
	1.a 全新相機，開始使用
	清除使用時間、拔除時間變數
	1分鐘後，清除本機Page25資料，更新本機Page25資料

	1.b 非全新相機，接第2項

2. 是否相同相機	讀相機序號與本機記錄之最近使用相機序號
	讀相機之flash 0xC、讀本機之EEPROM Page25，比對序號。
	2.a 不相同相機，禁止使用
	2.b 相同相機

(2.a)禁止使用
(2.b)(累計使用<30)且(累計拔除<30)且


累計使用30分	不到30分 flag_use_30m = 0	30分以上 flag_use_30m = 1
累計拔除30分	不到30分 flag_nouse_30m = 0	30分以上 flag_nouse_30m = 1
	

短時間拔除
長時間拔除



2. 非全新相機	讀相機的序號、讀本機Page25資料
    2.1 若序號不同，則判斷為重複使用。		//內視鏡不能穿插使用
    2.2 若序號相同，即連續使用，要分辨相機短暫拔除、主機短暫重啟、主機長時間重啟。
	讀相機使用時間A，讀本機的相機使用時間與相機拔除時間與斷電時間
	1. 若斷電時間 > 30分，判斷為重複使用。
	2. (若相機使用時間 < 30分 且 相機拔除時間 < 30分)	(且 斷電時間 < 30分)
		允許使用，更新使用時間、拔除時間變數
	3. (若相機使用時間 > 30分 或 相機拔除時間 > 30分 且 斷電時間 < 1分鐘)
		允許使用，更新使用時間、拔除時間變數







接上相機後，
	主機讀此相機序號
	主機讀此相機使用時間

1. 序號與之前相同，可能只是相機重新插拔、可能只是斷電重開。讀出
	1.1 比較時間
		1.1.1	已寫過30分鐘的時間，當時時間與	??
		
		1.1.1	已寫過1分鐘的時間，讀出此相機已使用時間（a值）、此相機拔除時間（B值），AB值更新至系統參數。



2. 序號與之前不同。
	2.1 相機已有1分鐘使用紀錄，判定為相機過期。
	2.2 相機沒有使用紀錄，判定為全新相機。清除主機記錄B值。




（若全新）
//1分鐘後寫此相機序號進主機
1分鐘後寫此相機序號進主機


主機需要記住現在相機的序號、上次使用相機的序號


最近一次使用的相機序號寫在主機的flash的Page 20
相機序號寫在相機的Page 0x0C
相機使用時間寫在相機的Page 0x0D
相機累計使用時間寫在相機的Page 0x0E


	

	
	